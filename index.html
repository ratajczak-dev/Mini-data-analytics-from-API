<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini data analytics from API</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Mini data analytics from API</h1>
    </header>

    <main>
        <table>
            <tr>
                <th>Users activity</th>
                <th>Average number of comments per post</th>
                <th>percentage of TODOs completed by users</th>
                <th>percentage of TODOs not completed by users</th>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </table>

        <h2>Users activity</h2>
        <canvas id="BarChart"></canvas>
        <p class="par"></p>

        <div id="Circle-Charts">
            <div>
                <h2>percentage of TODOs completed by users</h2>
                <canvas id="CircleChart1"></canvas>
                <p class="par"></p>
            </div>

            <div>
                <h2>percentage of TODOs not completed by users</h2>
                <canvas id="CircleChart2"></canvas>
                <p class="par"></p>
            </div>
        </div>
    </main>

    <script>
        const p1 = document.querySelectorAll(".par");
        const p2 = document.querySelector("#AvgCom");
        const td = document.querySelectorAll("td");

        //counting the number of posts per user (90% of this code fragment was created by AI lines: 50-58)
        const postCounts = {};
        const BarChart = document.querySelector("#BarChart")
        fetch('https://jsonplaceholder.typicode.com/posts')
            .then(response => response.json())
            .then(posts => {
                posts.forEach(post => {
                    postCounts[post.userId] = (postCounts[post.userId] || 0) + 1;
                });

                //users activity - chart
                let activity = Object.values(postCounts);

                new Chart(BarChart, {
                    type: 'bar',
                    data: {
                        labels: ['user1', 'user2', 'user3', 'user4', 'user5', 'user6', 'user7', 'user8', 'user9', 'user10'],
                        datasets: [{
                        label: 'users activity',
                        data: activity,
                        backgroundColor: [
                            'rgb(235, 169, 183)',
                            'rgb(227, 151, 232)',
                            'rgb(181, 145, 207)',
                            'rgb(175, 164, 224)',
                            'rgb(150, 160, 217)',
                            'rgb(155, 188, 207)',
                            'rgb(171, 207, 200)',
                            'rgb(169, 217, 185)',
                            'rgb(220, 230, 163)',
                            'rgb(242, 200, 145)'
                        ]
                    }]
                    },
                    options: {
                        responsive: false,
                        plugins: {
                            legend: {
                                position: 'left'
                            }
                        }
                    }
                })

                //adding values to the table on website
                td[0].innerHTML = `<ul> <li> User 1: ${activity[0]} </li> 
                    <li> User 2: ${activity[1]} </li> 
                    <li> User 3: ${activity[2]} </li> 
                    <li> User 4: ${activity[3]} </li> 
                    <li> User 5: ${activity[4]} </li> 
                    <li> User 6: ${activity[5]} </li> 
                    <li> User 7: ${activity[6]} </li> 
                    <li> User 8: ${activity[7]} </li> 
                    <li> User 9: ${activity[8]} </li> 
                    <li> User 10: ${activity[9]} </li> </ul>`;
            });

        //average number of comments per post
        const commentsCount = {};
        const comments = fetch('https://jsonplaceholder.typicode.com/comments')
            .then((response) => response.json())
            .then(comments => {
                comments.forEach(comment =>{
                    commentsCount[comment.postId] = (commentsCount[comment.postId] || 0) + 1;
                });

                let elements = Object.values(commentsCount);
                let length = Object.keys(commentsCount).length;
                let sumValue = 0;

                elements.forEach(element => {
                    sumValue = sumValue + element;
                });

                let average = sumValue / length;

                //adding values to the table on website
                td[1].innerText = `Post per user: ${average}`;
            });


        const completedTodos = {};
        const allTodos = {};
        const donePct = {};
        const NotDonePct = {};
        const CircleChart1 = document.querySelector("#CircleChart1");
        const CircleChart2 = document.querySelector("#CircleChart2");
        fetch('https://jsonplaceholder.typicode.com/todos')
            .then(response => response.json())
            .then(todos => {
                todos.forEach(todo =>{
                    if (todo.completed === true){
                        completedTodos[todo.userId] = (completedTodos[todo.userId] || 0) + 1; }
                    allTodos[todo.userId] = (allTodos[todo.userId] || 0) + 1;
                });

                //percentage of TODOs completed by users (was fixed by AI)
                for (const userId in allTodos) {
                    donePct[userId] = Math.round(completedTodos[userId] / allTodos[userId] * 100);
                }

                //adding values to the table on website
                td[2].innerHTML = `<ul> <li> User 1: ${donePct[1]} </li> 
                    <li> User 2: ${donePct[2]} </li> 
                    <li> User 3: ${donePct[3]} </li> 
                    <li> User 4: ${donePct[4]} </li> 
                    <li> User 5: ${donePct[5]} </li> 
                    <li> User 6: ${donePct[6]} </li> 
                    <li> User 7: ${donePct[7]} </li> 
                    <li> User 8: ${donePct[8]} </li> 
                    <li> User 9: ${donePct[9]} </li> 
                    <li> User 10: ${donePct[10]} </li> </ul>`;

                //percentage of TODOs not completed by users
                for (const userId in allTodos) {
                    NotDonePct[userId] = 100 - donePct[userId];
                }

                //adding values to the table on website
                td[3].innerHTML = `<ul> <li> User 1: ${NotDonePct[1]} </li> 
                    <li> User 2: ${NotDonePct[2]} </li> 
                    <li> User 3: ${NotDonePct[3]} </li> 
                    <li> User 4: ${NotDonePct[4]} </li> 
                    <li> User 5: ${NotDonePct[5]} </li> 
                    <li> User 6: ${NotDonePct[6]} </li> 
                    <li> User 7: ${NotDonePct[7]} </li> 
                    <li> User 8: ${NotDonePct[8]} </li> 
                    <li> User 9: ${NotDonePct[9]} </li> 
                    <li> User 10: ${NotDonePct[10]} </li> </ul>`;

                //percentage of TODOs completed by users Chart
                let percentage1 = Object.values(donePct);

                new Chart(CircleChart1, {
                    type: 'pie',
                    data: {
                        labels: ['user1', 'user2', 'user3', 'user4', 'user5', 'user6', 'user7', 'user8', 'user9', 'user10'],
                    datasets: [{
                        label: 'percentage of TODOs completed by users',
                        data: percentage1,
                        backgroundColor: [
                            'rgb(235, 169, 183)',
                            'rgb(227, 151, 232)',
                            'rgb(181, 145, 207)',
                            'rgb(175, 164, 224)',
                            'rgb(150, 160, 217)',
                            'rgb(155, 188, 207)',
                            'rgb(171, 207, 200)',
                            'rgb(169, 217, 185)',
                            'rgb(220, 230, 163)',
                            'rgb(242, 200, 145)'
                        ]
                    }]
                    },
                    options: {
                        responsive: false,
                        plugins: {
                            legend: {
                                position: 'right'
                            }
                        }
                    }
                })


                let percentage2 = Object.values(NotDonePct);

                new Chart(CircleChart2, {
                    type: 'pie',
                    data: {
                        labels: ['user1', 'user2', 'user3', 'user4', 'user5', 'user6', 'user7', 'user8', 'user9', 'user10'],
                    datasets: [{
                        label: 'percentage of TODOs completed by users',
                        data: percentage2,
                        backgroundColor: [
                            'rgb(235, 169, 183)',
                            'rgb(227, 151, 232)',
                            'rgb(181, 145, 207)',
                            'rgb(175, 164, 224)',
                            'rgb(150, 160, 217)',
                            'rgb(155, 188, 207)',
                            'rgb(171, 207, 200)',
                            'rgb(169, 217, 185)',
                            'rgb(220, 230, 163)',
                            'rgb(242, 200, 145)'
                        ]
                    }]
                    },
                    options: {
                        responsive: false,
                        plugins: {
                            legend: {
                                position: 'right'
                            }
                        }
                    }
                })
            });
        
    </script>
</body>
</html>